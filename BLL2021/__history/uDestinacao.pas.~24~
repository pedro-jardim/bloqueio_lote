unit uDestinacao;

interface

uses
  udmBloqueio,
  uIntegracaoUnilever,
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls,
  Soap.InvokeRegistry, System.Net.URLClient, Soap.Rio, Soap.SOAPHTTPClient;

type
  TfrmDestinacao = class(TForm)
    ScrollBox1: TScrollBox;
    GroupBox1: TGroupBox;
    Label2: TLabel;
    edtCodBloqueioWeb: TEdit;
    Label3: TLabel;
    Label4: TLabel;
    Label7: TLabel;
    edtQtdeCaixa: TEdit;
    edtCodLPN: TEdit;
    pnlResult: TPanel;
    lblRetorno: TLabel;
    pnlConfirmacao: TPanel;
    Button1: TButton;
    procedure FormShow(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
    procedure Destinacao;
    procedure AtualizaDestinacao(const pLPN: string);
  public
    { Public declarations }
    ic_confirmacao : Boolean;
    cd_lpn,
    cd_bloqueio_web,
    qt_bloqueio,
    cd_ : String;
  end;

var
  frmDestinacao: TfrmDestinacao;

implementation

{$R *.dfm}


procedure TfrmDestinacao.AtualizaDestinacao(const pLPN: string);
begin
  with dmBloqueio do
  begin
    qryAtualizaMovimentoDestinacao.Close;
    qryAtualizaMovimentoDestinacao.ParamByName('lpn').AsString := pLPN;
    qryAtualizaMovimentoDestinacao.ExecSQL;
    qryAtualizaMovimentoDestinacao.Close;
  end;
end;

procedure TfrmDestinacao.Button1Click(Sender: TObject);
begin
  Destinacao;
end;

procedure TfrmDestinacao.Destinacao;
var
  lValido    : Boolean;
  msgRetorno : String;
begin
  //--------------------------------------------------
  //-->> Confirma a Destinação
  //--------------------------------------------------
  lValido := DestinacaoLote(
              cd_bloqueio_web,                                                     //CodBloqueioWeb
              '13',                                                                //CodAcao
              dmBloqueio.qryParametroLogisticacd_local_bloqueio_unilever.asstring, //CodLocalBloqueio
              cd_lpn,                                                              //Numero da LPN
              msgRetorno                                                           //Mensagem de Retorno
            );

  if lValido then
  begin
    AtualizaDestinacao(cd_lpn);
    lblRetorno.Caption := 'LPN ' + cd_lpn +' - Destinada com Sucesso!';
  end
  else
    lblRetorno.Caption := msgRetorno;

  Application.ProcessMessages;
  Sleep(2000);

end;

procedure TfrmDestinacao.FormCreate(Sender: TObject);
begin
  with dmBloqueio.qryParametroLogistica do
  begin
    Close;
    Open;
  end;
end;

procedure TfrmDestinacao.FormShow(Sender: TObject);
begin

  pnlConfirmacao.Visible := ic_confirmacao;

  if not ic_confirmacao then
    Destinacao;

end;

end.
